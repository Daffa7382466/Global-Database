<!DOCTYPE html>
<html lang="id">
<head>
  <meta charset="UTF-8">
  <title>Canvas + Supabase Global Storage</title>
  <style>
    body { font-family: Arial, sans-serif; }
    canvas { border: 1px solid black; display: block; margin-bottom: 10px; }
  </style>
  <!-- Supabase JS SDK -->
  <script src="https://unpkg.com/@supabase/supabase-js"></script>
</head>
<body>
  <h2>Canvas dengan Global Storage (Supabase)</h2>

  <canvas id="myCanvas" width="500" height="400"></canvas>

  <input type="text" id="myInput" placeholder="Ketik sesuatu..." />
  <button onclick="submitText()">Submit</button>

  <script>
    // --- Konfigurasi Supabase ---
    const SUPABASE_URL = "https://amgamzesrbysxmkhanfi.supabase.co";
    const SUPABASE_KEY = "eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6ImFtZ2FtemVzcmJ5c3hta2hhbmZpIiwicm9sZSI6ImFub24iLCJpYXQiOjE3NTkyNDc2MDcsImV4cCI6MjA3NDgyMzYwN30.PS3tqJ8VE_1y8JLz4R62MocaWZiLL_gOaGSC_eFqcsw";
    const supabaseClient = supabase.createClient(SUPABASE_URL, SUPABASE_KEY);

    const canvas = document.getElementById("myCanvas");
    const ctx = canvas.getContext("2d");

    let messages = [];

    // Gambar canvas
    function drawCanvas() {
      ctx.clearRect(0, 0, canvas.width, canvas.height);
      ctx.font = "20px Arial";
      ctx.fillStyle = "blue";
      ctx.fillText("Daftar pesan global:", 20, 30);

      ctx.font = "16px Arial";
      ctx.fillStyle = "black";
      messages.forEach((msg, i) => {
        ctx.fillText(`${i + 1}. ${msg.text}`, 20, 60 + i * 25);
      });
    }

    // Ambil data dari Supabase
    async function loadMessages() {
      const { data, error } = await supabaseClient
        .from("messages")
        .select("*")
        .order("created_at", { ascending: true });

      if (error) {
        console.error("Error load:", error);
      } else {
        messages = data;
        drawCanvas();
      }
    }

    // Kirim data ke Supabase
    async function submitText() {
      const input = document.getElementById("myInput");
      const text = input.value.trim();

      if (text !== "") {
      const { error } = await supabaseClient
  .from("massage")   // âœ… sesuai nama tabel
  .insert([{ text }]);

        if (error) {
          console.error("Error insert:", error);
        } else {
          input.value = "";
          loadMessages();
        }
      }
    }

    // Pertama kali load
    loadMessages();
  </script>
</body>
</html>
